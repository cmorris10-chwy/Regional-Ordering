# README

The script that updates `sandbox_supply_chain.outl_excess_base` table is located [here](https://github.com/Chewy-Inc/supply-chain-etl/blob/master/Supplychain_Repository/sql/supplychain_0630_excess_inventory.sql). This link should be used to ensure that users are always using the most up-to-date script.

This table updates daily during the 0630 batch run. This does not mean it will complete at this time. Completion time is based on when the prior jobs finish as these scripts are ran in a queue. Because the completion timing differs day over day an automated email alert has been created to notify Cory Morris (projecct PM) when the data for today is improperly gathered. The data issue arises when inventory snapshot table has not updated completely by the time this script runs. In these cases the Safety Stock (SS) values input into the OUTL table and used to calculate an OUTL, are zero. This leads to a severe increase in excess inventory as the OUTLs will be lower than they should be without an SS value greater than 0. When this data update issue occurs, it is important to re-run the linked script above. 

## Updating Table Data for Weekends and Holiday ETL Issues

If the issue occurs over the weekend (Saturday or Sunday) or on a holiday, users will need to update the table's data for the problematic days using [this](https://github.com/cmorris10-chwy/Regional-Ordering/blob/main/OUTL%20Excess%20Base%20Table/Remove%20and%20Update%20bad%20data.sql) script. For updating issues on these days the script assumes that the data for the last correct day prior to the issue should be utilized. This is because we are not able to currently go back in time and gather the necessary data inputs to recreate the data for a past day.

Users will need to first add the dates they wish to delete data for to [line 5](https://github.com/cmorris10-chwy/Regional-Ordering/blob/2b8d32c0886f13f02aae1350ae0ba5585653c338/OUTL%20Excess%20Base%20Table/Remove%20and%20Update%20bad%20data.sql#L5). These dates should be input as a list of strings separated by a comma `,`. Users can find the problematic dates by looking at the automated email alert output or by using the query on [line 2](https://github.com/cmorris10-chwy/Regional-Ordering/blob/2b8d32c0886f13f02aae1350ae0ba5585653c338/OUTL%20Excess%20Base%20Table/Remove%20and%20Update%20bad%20data.sql#L2). Users will then need to add a union to the `INSERT` query for each date that needs data created and input to the table. For example, in the current script we are deleting data for 5/28 and 5/29. We then create a union to insert data for the two days as shown starting on [line 8](https://github.com/cmorris10-chwy/Regional-Ordering/blob/0afc54c7d53d8c599ae91f3083401c56e5699016/OUTL%20Excess%20Base%20Table/Remove%20and%20Update%20bad%20data.sql#L8). If more than two dates need to be updated then add another union and update the snapshot_date. Everything else in the query should remain unchanged.
